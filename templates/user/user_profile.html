{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Profile - UNITEN</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
  <link rel="stylesheet" href="{% static 'bootstrap_icones/iconsfonts/bootstrap-icons.css' %}">
  <link rel="stylesheet" href="{% static 'css/side_nav_bar.css' %}">
  <link rel="stylesheet" href="{% static 'FontAwesome/fontawesome-free-6.7.2-web/css/all.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/footer.css' %}">
  <style>
  .wrapper {
    display: flex;
  }

  /* Sidebar */
  #sidebar {
    width: 250px;
    transition: all 0.3s ease;
  }

  #sidebar.active {
    margin-left: -250px;
  }

  /* Content */
  .content-area {
    margin-left: 250px;
    transition: margin-left 0.3s ease;
    padding: 2rem;
    flex: 1;
  }

  .content-area.active {
    margin-left: 0;
  }

  /* Footer */
  footer {
    margin-left: 250px;
    transition: margin-left 0.3s ease;
  }

  footer.active {
    margin-left: 0;
  }

  .sidebar {
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 250px;
  background-color: #343a40;
  color: white;
  padding-top: 60px;
  transition: all 0.3s ease;
  z-index: 1000;
}

.sidebar a {
  display: block;
  color: white;
  padding: 10px 20px;
  text-decoration: none;
}

.sidebar a:hover {
  background-color: #495057;
  color: #fff;
}
#page-header {
  margin-left: 250px;
  transition: margin-left 0.3s ease;
}

#page-header.active {
  margin-left: 0;
}


</style>

</head>

<body>
  <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>

  <header id="page-header"class="bg-dark text-white py-4 d-flex justify-content-between align-items-center" style="padding: 0 2rem;">
    <h2 class="mb-0">User Profile</h2>
    <a href="{% url 'homepage' %}">
      <img src="{% static 'images/logo_uniten-1.png' %}" alt="UNITEN Logo" class="img-fluid" style="height: 80px;">
    </a>
  </header>

  <div class="wrapper">
    {% include 'includes/user_sidebar.html' %}

    <div class="content-area" id="content">
       {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
      <div class="card p-4">
        <div class="text-center">
          <img src="https://i.imgur.com/wvxPV9S.png" class="rounded-circle shadow" width="120" alt="Profile Picture">
          <h4 class="mt-3">{{ user.name }}</h4>
          <p class="text-muted">@{{ user.user_id }}</p>
        </div>

        <hr>

        <form method="POST">
          {% csrf_token %}
          <div class="row">
            <div class="col-md-6">
              <p><strong>Student ID:</strong> {{ user.user_id }}</p>
              <p><strong>Course:</strong> {{ user.program }}</p>
              <p><strong>Country:</strong> {{ user.country }}</p>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="phone" class="form-label"><strong>Phone:</strong></label>
                <input type="text" name="phone_number" id="phone" class="form-control" value="{{ user.phone_number }}">
              </div>
              <div class="mb-3">
                <label for="new_password" class="form-label"><strong>New Password:</strong></label>
                <div class="input-group">
                  <input type="password" name="new_password" class="form-control" id="passwordField" placeholder="Leave blank to keep current password">
                  <button class="btn btn-outline-secondary" type="button" id="togglePassword">üëÅÔ∏è</button>
                </div>
              </div>
            </div>
          </div>

          <hr>

          <div class="text-center">
            {% if current_room %}
              <h5>Your Current Room</h5>
              <p><strong>Room Type:</strong> {{ current_room.apartment.type }}</p>
              <p><strong>Block:</strong> {{ current_room.apartment.block.name }}</p>
              <p><strong>Level:</strong> {{ current_room.apartment.level }}</p>
              <p><strong>Room Number:</strong> {{ current_room.room_number }}</p>
              
            {% else %}
              <p class="text-muted">No current booking</p>
            {% endif %}
          </div>

          <div class="d-flex justify-content-between mt-4">
            <a href="{% url 'cancellation' %}" class="btn btn-danger">Cancel Booking</a>
            <a href="{% url 'reapplying' %}" class="btn btn-success">Reapply for a Room</a>
            <button class="btn btn-dark">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  {% include 'includes/footer.html' %}

  <!-- JS Scripts -->
<script>
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const content = document.getElementById('content');
    const footer = document.querySelector('footer');
    const header = document.getElementById('page-header');

    sidebar.classList.toggle('active');
    content.classList.toggle('active');
    footer.classList.toggle('active');
    header.classList.toggle('active');
  }

  document.addEventListener("DOMContentLoaded", function () {
    const currentPath = window.location.pathname.toLowerCase();
    document.querySelectorAll('#sidebar a').forEach(link => {
      const linkPath = link.getAttribute('href').toLowerCase();
      if (currentPath.includes(linkPath)) {
        link.classList.add('active');
      }
    });
  });

  document.getElementById('togglePassword').addEventListener('click', function () {
    const passwordField = document.getElementById('passwordField');
    passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
  });
</script>

  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>
